machine basic_machine {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_basic_vm {
	basic_machine {}
}

machine basic_machine_uefi {
	cpus: 1
	ram: 512Mb
	disk main: {
		size: 4Gb
	}
	loader: "/usr/share/OVMF/OVMF_CODE.fd"

	video main: {
		qemu_mode: "qxl"
	}
}

test create_basic_vm_uefi {
	basic_machine_uefi {
		start
		wait "UEFI Interactive Shell"
	}
}

machine vm_no_cpus {
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_vm_no_cpus {
	vm_no_cpus {}
}

machine vm_no_ram {
	cpus: 1
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_vm_no_ram {
	vm_no_ram {}
}

machine vm_no_disk {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
}

test create_vm_no_disk {
	vm_no_disk {}
}

machine vm_too_many_disks{
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk first: {
		size: 4Gb
	}
	disk second: {
		size: 4Gb
	}
	disk third: {
		size: 4Gb
	}
	disk fourth: {
		size: 4Gb
	}
}

test create_vm_too_many_disks {
	vm_too_many_disks {}
}

machine vm_disk_no_size {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {

	}
}

test create_vm_disk_no_size {
	vm_disk_no_size {}
}

machine vm_identical_disks {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk first: {
		size: 4Gb
	}
	disk second: {
		size: 4Gb
	}
	disk first: {
		size: 4Gb
	}
}

test create_vm_identical_disks {
	vm_identical_disks {}
}

machine vm_nic_no_attached_to {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk first: {
		size: 4Gb
	}
	nic my_nic: {

	}
}

test create_vm_nic_no_attached_to {
	vm_nic_no_attached_to {}
}

network my_network {
	mode: "internal"
}

machine vm_nic_incorrect_mac {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk first: {
		size: 4Gb
	}
	nic my_nic: {
		attached_to: "my_network"
		mac: "AA:BB:CC:DD:EE:FF:AA"
	}
}

test create_vm_nic_incorrect_mac {
	vm_nic_incorrect_mac {}
}

machine vm_nic_incorrect_type {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk first: {
		size: 4Gb
	}
	nic my_nic: {
		attached_to: "my_network"
		adapter_type: "some_type"
	}
}

test create_vm_nic_incorrect_type {
	vm_nic_incorrect_type {}
}

machine vm_identical_nic_names {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk first: {
		size: 4Gb
	}
	nic my_nic: {
		attached_to: "my_network"
	}

	nic my_nic2: {
		attached_to: "my_network"
	}

	nic my_nic: {
		attached_to: "my_network"
	}
}

test create_vm_identical_nic_names {
	vm_identical_nic_names {}
}

machine vm_iso_does_not_exist {
	cpus: 1
	ram: 512Mb
	iso: "/opt/some_iso.iso"
	disk first: {
		size: 4Gb
	}
}

test create_vm_iso_does_not_exist {
	vm_iso_does_not_exist {}
}

machine vm_iso_does_not_exist_1 {
	cpus: 1
	ram: 512Mb
	iso: "../some_iso.iso"
	disk first: {
		size: 4Gb
	}
}

test create_vm_iso_does_not_exist_1 {
	vm_iso_does_not_exist_1 {}
}

machine vm_image_does_not_exist {
	cpus: 1
	ram: 512Mb
	disk first: {
		source: "/opt/some_image.img"
	}
}

machine vm_loader_does_not_exist {
	cpus: 1
	ram: 512Mb
	loader: "/opt/some_loader.fd"
	disk first: {
		size: 4Gb
	}
}

test create_vm_loader_does_not_exist {
	vm_loader_does_not_exist {}
}

test create_vm_image_does_not_exist {
	vm_image_does_not_exist {}
}

machine vm_image_does_not_exist_1 {
	cpus: 1
	ram: 512Mb
	disk first: {
		source: "../some_image.img"
	}
}

test create_vm_image_does_not_exist_1 {
	vm_image_does_not_exist_1 {}
}


machine vm_unknown_network {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk first: {
		size: 4Gb
	}

	nic my_nic: {
		attached_to: "some_network"
	}
}

test create_vm_unknown_network {
	vm_unknown_network {}
}


machine vm_unknown_attr {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk first: {
		some_attr: 4Gb
	}
}

test create_vm_unknown_attr {
	vm_unknown_attr {}
}

machine vm_attr_requires_name {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk: {
		size: 4Gb
	}
}

test create_vm_attr_requires_name {
	vm_attr_requires_name {}
}

machine vm_attr_must_have_no_name {
	cpus: 1
	ram main_ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_vm_attr_must_have_no_name {
	vm_attr_must_have_no_name {}
}

machine vm_attr_type_mismatch {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: "4Gb"
	}
}

test create_vm_attr_type_mismatch {
	vm_attr_type_mismatch {}
}

machine vm_attr_diplucates {
	cpus: 1
	cpus: 2
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_vm_attr_diplucates {
	vm_attr_diplucates {}
}

machine vm_negative_attribute {
	cpus: -7
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_vm_negative_attribute {
	vm_negative_attribute {}
}

machine vm_unknown_video_mode {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
	video main_video: {
		qemu_mode: "some_video_mode"
	}
}

test create_vm_unknown_video_mode {
	vm_unknown_video_mode {}
}


machine vm_multiple_videos {
	cpus: 1
	ram: 512Mb
	disk main: {
		size: 4Gb
	}

	video video1: {}
	video video2: {}
}

test create_vm_multiple_videos {
	vm_multiple_videos {}
}

machine basic_machine_qxl {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_basic_vm_qxl {
	basic_machine_qxl {
		start
		wait "Language"
		abort "stop here"
	}
}
