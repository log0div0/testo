machine basic_machine {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_basic_vm {
	basic_machine {}
}

macro generate_machine(vm_name, size) {

	machine "${vm_name}" {
		cpus: 1
		ram: 512Mb
		iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
		disk main: {
			size: "${size}"
		}
	}
}

generate_machine("basic_machine_2", "4Gb")

test create_basic_vm_2 {
	basic_machine_2 {}
}

machine basic_machine_uefi {
	cpus: 1
	ram: 512Mb
	disk main: {
		size: 4Gb
	}
	loader: "/usr/share/OVMF/OVMF_CODE.fd"

	video main: {
		adapter_type: "qxl"
	}
}

test create_basic_vm_uefi {
	basic_machine_uefi {
		start
		wait "UEFI Interactive Shell"
	}
}

machine basic_machine_qxl {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_basic_vm_qxl {
	basic_machine_qxl {
		start
		wait "Language"
		abort "stop here"
	}
}

machine basic_machine_usb2_1 {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}
}

test create_basic_machine_usb2_1 {
	basic_machine_usb2_1 {
		start
		wait "Language"
		abort "stop here"
	}
}

machine basic_machine_usb3 {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}

	qemu_enable_usb3: true
}

test create_basic_machine_usb3 {
	basic_machine_usb3 {
		start
		wait "Language"
		abort "stop here"
	}
}

machine basic_machine_usb2_2 {
	cpus: 1
	ram: 512Mb
	iso: "/opt/ubuntu-16.04.6-server-amd64.iso"
	disk main: {
		size: 4Gb
	}

	qemu_enable_usb3: false
}

test create_basic_machine_usb2_2 {
	basic_machine_usb2_2 {
		start
		wait "Language"
		abort "stop here"
	}
}
