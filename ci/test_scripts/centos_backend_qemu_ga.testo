include "centos_backend_qemu.testo"

[no_snapshots: true]
test centos_backend_qemu_exec_timeout: centos_backend_qemu_install_guest_additions {
	centos {
		copyto "${TEST_ASSETS_DIR}/backend/action_ga.testo" "/opt/scripts/action_ga.testo"

		exec bash """
			set +o pipefail
			set +e
			output=$(testo run /opt/scripts/action_ga.testo --stop_on_fail --test_spec exec_timeout)
			[[ $output == *"Error while performing action exec bash"* ]]
			[[ $output == *"Timeout was triggered"* ]]
		""" timeout 30m

	}
}

[no_snapshots: true]
test centos_backend_qemu_copyto_from_doesnt_exist_runtime: centos_backend_qemu_install_guest_additions {
	centos {
		copyto "${TEST_ASSETS_DIR}/backend/action_ga.testo" "/opt/scripts/action_ga.testo"

		exec bash """
			set +o pipefail
			set +e
			output=$(testo run /opt/scripts/action_ga.testo --stop_on_fail --test_spec copyto_from_unexisting_runtime)
			[[ $output == *"Preparing the environment for test copyto_from_unexisting_runtime"* ]]
			[[ $output == *"Specified path doesn't exist: /some/unexisting_shit"* ]]
		""" timeout 30m
	}
}

[no_snapshots: true]
test centos_backend_qemu_copyto_nocheck: centos_backend_qemu_install_guest_additions {
	centos {
		copyto "${TEST_ASSETS_DIR}/backend/action_ga.testo" "/opt/scripts/action_ga.testo"

		exec bash """
			testo run /opt/scripts/action_ga.testo --stop_on_fail --test_spec copyto_nocheck
		""" timeout 30m
	}
}