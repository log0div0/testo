include "centos_backend_qemu.testo"

[no_snapshots: true]
test centos_copyto_cksum_file: centos_backend_qemu_install_guest_additions {
	centos {
		copyto "${TEST_ASSETS_DIR}/cksum/copyto.testo" "/opt/scripts/copyto.testo"

		exec bash """
			mkdir /opt/copyto_folder
			echo "Hello world!" > /opt/copyto_folder/test_file.txt
		"""

		exec bash """
			testo run /opt/scripts/copyto.testo --test_spec copyto_cksum_file
		""" timeout 30m

		exec bash """
			echo "Another Hello world!" >> /opt/copyto_folder/test_file.txt
		"""

		exec bash """
			testo run /opt/scripts/copyto.testo --test_spec copyto_cksum_file --assume_yes | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m
	}
}

[no_snapshots: true]
test centos_copyto_cksum_folder: centos_backend_qemu_install_guest_additions {
	centos {
		copyto "${TEST_ASSETS_DIR}/cksum/copyto.testo" "/opt/scripts/copyto.testo"

		exec bash """
			mkdir /opt/copyto_folder
			echo "Hello world!" > /opt/copyto_folder/test_file.txt
		"""

		exec bash """
			testo run /opt/scripts/copyto.testo --test_spec copyto_cksum_folder
		""" timeout 30m

		exec bash """
			echo "Another Hello world!" >> /opt/copyto_folder/test_file.txt
		"""

		exec bash """
			testo run /opt/scripts/copyto.testo --test_spec copyto_cksum_folder --assume_yes | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m
	}
}

[no_snapshots: true]
test centos_flash_cksum_folder: centos_install_testo_cpu {
	centos {
		copyto "${TEST_ASSETS_DIR}/cksum/flash.testo" "/opt/scripts/flash.testo"

		exec bash """
			mkdir /opt/flash_folder
			echo "Hello world!" > /opt/flash_folder/test_file.txt
		"""

		exec bash """
			testo run /opt/scripts/flash.testo --test_spec flash_cksum
		""" timeout 30m

		exec bash """
			testo run /opt/scripts/flash.testo --test_spec flash_cksum --assume_yes | grep "RUN SUCCESSFULLY: 0"
		""" timeout 30m

		exec bash """
			echo "Another Hello world!" >> /opt/flash_folder/test_file.txt
		"""

		exec bash """
			testo run /opt/scripts/flash.testo --test_spec flash_cksum --assume_yes | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m
	}
}

[no_snapshots: true]
test centos_mouse_specifiers: centos_install_testo_cpu {
	centos {
		copyto "${TEST_ASSETS_DIR}/cksum/actions_original.testo" "/opt/scripts/actions.testo"

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers1 | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers2 | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers3 | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers1 --assume_yes | grep "RUN SUCCESSFULLY: 0"
		""" timeout 30m

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers2 --assume_yes | grep "RUN SUCCESSFULLY: 0"
		""" timeout 30m

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers3 --assume_yes | grep "RUN SUCCESSFULLY: 0"
		""" timeout 30m


		copyto "${TEST_ASSETS_DIR}/cksum/actions_modified.testo" "/opt/scripts/actions.testo"

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers1 --assume_yes | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers2 --assume_yes | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m

		exec bash """
			testo run /opt/scripts/actions.testo --test_spec mouse_modifiers3 --assume_yes | grep "RUN SUCCESSFULLY: 1"
		""" timeout 30m

	}
}
