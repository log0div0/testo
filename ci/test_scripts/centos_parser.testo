
include "centos.testo"

[no_snapshots: true]
test centos_parser: centos_install_testo_cpu {
	centos {
		copyto "${TEST_ASSETS_DIR}/parser" "/opt/scripts/parser"

		exec bash "cp /opt/scripts/parser/* /"

		exec bash """
			set +o pipefail
			testo run /macro_body_eof.testo 2>&1 > /dev/null | grep "Error: macro \\\"some_macro\\\" body reached the end of file without closing \\\"}\\\""
			testo run /invalid_mouse_parented_expr_0.testo 2>&1 > /dev/null | grep "Error: Unknown selective object type: ("
			testo run /invalid_mouse_parented_expr_1.testo 2>&1 > /dev/null | grep "Error: Unknown selective object type: !"
			testo run /vm_identical_disks.testo 2>&1 > /dev/null | grep "Error: duplicate attribute: \\\"disk first\\\""
			testo run /vm_identical_nic_names.testo 2>&1 > /dev/null | grep "Error: duplicate attribute: \\\"nic my_nic\\\""
			testo run /vm_unknown_attr.testo 2>&1 > /dev/null | grep "Error: Unknown attribute: some_attr"
			testo run /vm_attr_requires_name.testo 2>&1 > /dev/null | grep "Error: unexpected token \\\":\\\", expected: IDENTIFIER"
			testo run /vm_attr_must_have_no_name.testo 2>&1 > /dev/null | grep "Error: unexpected token \\\"main_ram\\\", expected: :"
			testo run /vm_attr_type_mismatch.testo 2>&1 > /dev/null | grep "Error: expected STRING or SIZE, but got NUMBER \\\"4\\\""
			testo run /vm_attr_diplucates.testo 2>&1 > /dev/null | grep "Error: duplicate attribute: \\\"cpus\\\""
		"""
	}
}
