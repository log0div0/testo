
include "centos.testo"

[no_snapshots: true]
test centos_for_range_param: centos_prepare_testo {
	centos {
		copyto "${TEST_ASSETS_DIR}/param_resolve/for_tests.testo" "/opt/scripts/for_tests.testo"
		exec bash """
			output=$(testo run /opt/scripts/for_tests.testo --stop_on_fail --test_spec for_range_param --report_folder /opt/report)
			[[ $output == *"0: iteration #0"* ]]
			[[ $output == *"0: iteration #1"* ]]
			[[ $output == *"0: iteration #2"* ]]
			[[ $output == *"0: iteration #3"* ]]

			[[ $output == *"1: iteration #0"* ]]
			[[ $output == *"1: iteration #1"* ]]
			[[ $output == *"1: iteration #2"* ]]
			[[ $output != *"1: iteration #3"* ]]
		"""
	}
}

[no_snapshots: true]
test centos_actions_param: centos_prepare_testo {
	centos {
		copyto "${TEST_ASSETS_DIR}/param_resolve/actions.testo" "/opt/scripts/actions.testo"
		exec bash """
			set +o pipefail
			testo run /opt/scripts/actions.testo --test_spec sleep_param | grep "Sleeping in virtual machine my_ubuntu_server for 1s"
			testo run /opt/scripts/actions.testo --test_spec sleep_param_invalid | grep "Error: can't convert string value \\\"-7\\\" to TIME INTERVAL"
			testo run /opt/scripts/actions.testo --test_spec sleep_token | grep "Sleeping in virtual machine my_ubuntu_server for 1s"
		"""
	}
}
