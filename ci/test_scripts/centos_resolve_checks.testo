
include "centos.testo"

[no_snapshots: true]
test centos_for_range_param: centos_prepare_testo {
	centos {
		copyto "${TEST_ASSETS_DIR}/param_resolve/for_tests.testo" "/opt/scripts/for_tests.testo"
		exec bash """
			output=$(testo run /opt/scripts/for_tests.testo --stop_on_fail --test_spec for_range_param --report_folder /opt/report)
			[[ $output == *"0: iteration #0"* ]]
			[[ $output == *"0: iteration #1"* ]]
			[[ $output == *"0: iteration #2"* ]]
			[[ $output == *"0: iteration #3"* ]]

			[[ $output == *"1: iteration #0"* ]]
			[[ $output == *"1: iteration #1"* ]]
			[[ $output == *"1: iteration #2"* ]]
			[[ $output != *"1: iteration #3"* ]]
		"""
	}
}

[no_snapshots: true]
test centos_actions_param: centos_prepare_testo {
	centos {
		copyto "${TEST_ASSETS_DIR}/param_resolve/actions.testo" "/opt/scripts/actions.testo"
		exec bash """
			set +o pipefail
			testo run /opt/scripts/actions.testo --test_spec check_sleep_param | grep "Sleeping in virtual machine my_ubuntu_server for 1s"
			testo run /opt/scripts/actions.testo --test_spec check_sleep_param_invalid | grep "Error: can't convert string value \\\"-7\\\" to TIME INTERVAL"
			testo run /opt/scripts/actions.testo --test_spec check_sleep_token | grep "Sleeping in virtual machine my_ubuntu_server for 1s"

			testo run /opt/scripts/actions.testo --test_spec check_type_param | grep "Typing \\\"Hello 1s\\\" with interval 1s in virtual machine my_ubuntu_server"
			testo run /opt/scripts/actions.testo --test_spec check_type_param_invalid | grep "Error: can't convert string value \\\"interval\\\" to TIME INTERVAL"
			testo run /opt/scripts/actions.testo --test_spec check_type_token | grep "Typing \\\"Hello 1s\\\" with interval 1s in virtual machine my_ubuntu_server"

			testo run /opt/scripts/actions.testo --test_spec check_wait_param | grep "Waiting \\\"Hello 200ms\\\" for 200ms with interval 200ms in virtual machine my_ubuntu_server"
			testo run /opt/scripts/actions.testo --test_spec check_wait_param_invalid | grep "Error: can't convert string value \\\"interval\\\" to TIME INTERVAL"
			testo run /opt/scripts/actions.testo --test_spec check_wait_token | grep "Waiting \\\"Hello 200ms\\\" for 200ms with interval 200ms in virtual machine my_ubuntu_server"

			testo run /opt/scripts/actions.testo --test_spec check_shutdown_param | grep "Shutting down virtual machine my_ubuntu_server with timeout 200ms"
			testo run /opt/scripts/actions.testo --test_spec check_shutdown_param_invalid | grep "Error: can't convert string value \\\"\\\" to TIME INTERVAL"
			testo run /opt/scripts/actions.testo --test_spec check_shutdown_token | grep "Shutting down virtual machine my_ubuntu_server with timeout 200ms"
		"""
	}
}
