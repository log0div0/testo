
include "centos.testo"

[no_snapshots: true]
test centos_semantic: centos_prepare_testo {
	centos {
		copyto "${TEST_ASSETS_DIR}/semantic" "/opt/scripts/semantic"

		exec bash """
			set +o pipefail
			cp /opt/scripts/semantic/* /
			testo run /0001.testo | grep '/0001.testo:6:1: Error: test "A" is already defined here: /0001.testo:2:1'
			testo run /0002.testo | grep '/0002.testo:6:1: Error: macro "A" is already defined here: /0002.testo:2:1'
			testo run /0003.testo | grep '/0003.testo:4:1: Error: param "A" is already defined here: /0003.testo:2:1'
			testo run /0004.testo | grep '/0004.testo:6:1: Error: machine "A" is already defined here: /0004.testo:2:1'
			testo run /0005.testo | grep '/0005.testo:6:1: Error: flash drive "A" is already defined here: /0005.testo:2:1'
			testo run /0006.testo | grep '/0006.testo:6:1: Error: network "A" is already defined here: /0006.testo:2:1'
			testo run /0007.testo | grep "/0007.testo:2:9: Error: can't specify test as a parent to itself A"
			testo run /0008.testo | grep '/0008.testo:2:9: Error: unknown test: B'
			testo run /0009.testo | grep '/0009.testo:6:12: Error: this test was already specified in parent list A'
		"""

		exec bash """
			set +o pipefail
			testo run /mouse_specificators_exceptions.testo --test_spec from_0 | grep "Error: specifier from_top requires a non-negative number as an argument"
			testo run /mouse_specificators_exceptions.testo --test_spec from_1 | grep "Error: specifier from_left requires a non-negative number as an argument"
			testo run /mouse_specificators_exceptions.testo --test_spec from_2 | grep "Error: you can\'t use specifier from_top after another \\\"from\\\" specifier"
			testo run /mouse_specificators_exceptions.testo --test_spec from_3 | grep "Error: you can\'t use specifier from_top after a \\\"precision\\\" specifier"
			testo run /mouse_specificators_exceptions.testo --test_spec from_4 | grep "Error: you can\'t use specifier from_left after a \\\"move\\\" specifier"
			testo run /mouse_specificators_exceptions.testo --test_spec centering_0 | grep "Error: specifier center must not have an argument"
			testo run /mouse_specificators_exceptions.testo --test_spec centering_1 | grep "Error: you can\'t use specifier right_top after another \\\"precision\\\" specifier"
			testo run /mouse_specificators_exceptions.testo --test_spec centering_2 | grep "Error: you can\'t use specifier right_center after a \\\"move\\\" specifier"
			testo run /mouse_specificators_exceptions.testo --test_spec move_0 | grep "Error: specifier move_right requires a non-negative number as an argument"
			testo run /mouse_specificators_exceptions.testo --test_spec move_1 | grep "Error: specifier move_right requires a non-negative number as an argument"
			testo run /mouse_specificators_exceptions.testo --test_spec unknown | grep "Error: unknown specifier: move_bottom"
		"""
	}
}
