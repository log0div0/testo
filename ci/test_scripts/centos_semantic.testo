
include "centos.testo"

[no_snapshots: true]
test centos_semantic: centos_prepare_testo {
	centos {
		copyto "${TEST_ASSETS_DIR}/semantic" "/opt/scripts/semantic"

		exec bash "cp /opt/scripts/semantic/* /"

		exec bash """
			set +o pipefail
			testo run /misc.testo --test_spec empty_wait_text | grep "Error: empty string in text selection"
			testo run /misc.testo --test_spec empty_mouse_move_text | grep "Error: empty string in text selection"
			testo run /misc.testo --test_spec empty_wait_js | grep "Error: empty script in js selection"
			testo run /misc.testo --test_spec empty_mouse_move_js | grep "Error: empty script in js selection"
			testo run /misc.testo --test_spec invalid_wait_js | grep "Error while validating js selection"
			testo run /misc.testo --test_spec invalid_mouse_move_js | grep "Error while validating js selection"
		"""

		exec bash """
			set +o pipefail
			testo run /0001.testo | grep '/0001.testo:6:1: Error: test "A" is already defined here: /0001.testo:2:1'
			testo run /0002.testo | grep '/0002.testo:6:1: Error: macro "A" is already defined here: /0002.testo:2:1'
			testo run /0003.testo | grep '/0003.testo:4:1: Error: param "A" is already defined here: /0003.testo:2:1'
			testo run /0004.testo | grep '/0004.testo:6:1: Error: machine "A" is already defined here: /0004.testo:2:1'
			testo run /0005.testo | grep '/0005.testo:6:1: Error: flash drive "A" is already defined here: /0005.testo:2:1'
			testo run /0006.testo | grep '/0006.testo:6:1: Error: network "A" is already defined here: /0006.testo:2:1'
			testo run /0007.testo | grep "/0007.testo:2:9: Error: can't specify test as a parent to itself A"
			testo run /0008.testo | grep '/0008.testo:2:9: Error: unknown test: B'
			testo run /0009.testo | grep '/0009.testo:6:12: Error: this test was already specified in parent list A'
		"""

		exec bash """
			set +o pipefail
			testo run /mouse_specificators.testo --test_spec from_0 | grep "Error: specifier from_top requires a non-negative number as an argument"
			testo run /mouse_specificators.testo --test_spec from_1 | grep "Error: specifier from_left requires a non-negative number as an argument"
			testo run /mouse_specificators.testo --test_spec from_2 | grep "Error: you can\'t use specifier from_top after another \\\"from\\\" specifier"
			testo run /mouse_specificators.testo --test_spec from_3 | grep "Error: you can\'t use specifier from_top after a \\\"precision\\\" specifier"
			testo run /mouse_specificators.testo --test_spec from_4 | grep "Error: you can\'t use specifier from_left after a \\\"move\\\" specifier"
			testo run /mouse_specificators.testo --test_spec centering_0 | grep "Error: specifier center must not have an argument"
			testo run /mouse_specificators.testo --test_spec centering_1 | grep "Error: you can\'t use specifier right_top after another \\\"precision\\\" specifier"
			testo run /mouse_specificators.testo --test_spec centering_2 | grep "Error: you can\'t use specifier right_center after a \\\"move\\\" specifier"
			testo run /mouse_specificators.testo --test_spec move_0 | grep "Error: specifier move_right requires a non-negative number as an argument"
			testo run /mouse_specificators.testo --test_spec move_1 | grep "Error: specifier move_right requires a non-negative number as an argument"
			testo run /mouse_specificators.testo --test_spec unknown | grep "Error: unknown specifier: move_bottom"
			testo run /mouse_specificators.testo --test_spec js_with_specificators | grep "Error: mouse specifiers are not supported for js selections"
		"""

		exec bash """
			set +o pipefail
			testo run /macro_call.testo --test_spec unknown_macro | grep "Error: unknown macro: some_macro"
			testo run /macro_call.testo --test_spec too_few_args | grep "Error: expected at least 2 args, 1 provided"
			testo run /macro_call.testo --test_spec too_many_args | grep "Error: expected at most 4 args, 5 provided"
			testo run /macro_call.testo --test_spec wrong_macro_0 | grep "Error: duplicate macro arg: arg1"
			testo run /macro_call.testo --test_spec wrong_macro_1 | grep "Error: default value must be specified for macro arg arg3"
		"""

		exec bash """
			set +o pipefail
			testo run /for.testo --test_spec wrong_r1_0 | grep "Error: Can\'t convert range start 30ms to a non-negative number"
			testo run /for.testo --test_spec wrong_r1_1 | grep "Error: Can\'t convert range start -5 to a non-negative number"
			testo run /for.testo --test_spec wrong_r2_0 | grep "Error: Can\'t convert range finish 30ms to a non-negative number"
			testo run /for.testo --test_spec wrong_r2_1 | grep "Error: Can\'t convert range finish -5 to a non-negative number"
			testo run /for.testo --test_spec wrong_r2_2 | grep "Error: Can\'t convert range finish 30ms to a non-negative number"
			testo run /for.testo --test_spec wrong_r2_3 | grep "Error: Can\'t convert range finish -5 to a non-negative number"
			testo run /for.testo --test_spec wrong_start_finish_0 | grep "Error: start of the range 5 is greater or equal to finish 4"
			testo run /for.testo --test_spec wrong_start_finish_1 | grep "Error: start of the range 0 is greater or equal to finish 0"
		"""
	}
}
