
include "../common.testo"

network nat {
	mode: "nat"
}

machine negotiator_testing {
	cpus: 1
	ram: 1024Mb
	iso: "${ISO_DIR}/ubuntu-16.04.6-server-amd64.iso"
	disk_size: 4Gb

	nic nat: {
		attached_to: "nat"
		adapter_type: "e1000"
	}
}

test ubuntu_installation {
	negotiator_testing install_ubuntu("negotiator", "user", "1111")
}

test install_negotiator: ubuntu_installation {
	negotiator_testing {
		install_guest_additions("negotiator", "user", "1111")
		unplug dvd
	}
}

test install_guest_additions: install_negotiator {
	negotiator_testing {
		plug dvd "${NEGOTIATOR_DIR}/guest_additions.iso"
		type "mount /dev/cdrom /media"; press Enter
		wait "mounting read-only";
		type "cp /media/guest_additions /opt"; press Enter
		type "/opt/guest_additions"; press Enter
		wait timeout 2s
		exec bash """for i in {1..5}
			do
				echo "Hello world $i"
			done
		"""
		abort "stop here"
	}
}
