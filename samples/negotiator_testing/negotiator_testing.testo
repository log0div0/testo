
include "../common.testo"

network nat {
	mode: "nat"
}

machine negotiator_testing {
	cpus: 1
	ram: 1024Mb
	iso: "${ISO_DIR}/ubuntu-16.04.6-server-amd64.iso"
	disk_size: 4Gb

	nic nat: {
		attached_to: "nat"
		adapter_type: "e1000"
	}
}

test ubuntu_installation {
	negotiator_testing install_ubuntu("negotiator", "user", "1111")
}

test install_negotiator: ubuntu_installation {
	negotiator_testing {
		install_guest_additions("negotiator", "user", "1111")
		unplug dvd
	}
}

test install_guest_additions: ubuntu_installation {
	negotiator_testing {
		enter_sudo("negotiator", "user", "1111")
		type "apt install daemon"; press Enter
		wait "Setting up daemon"
		plug dvd "${NEGOTIATOR_DIR}/testo-guest-additions.iso"
		wait timeout 5s
		type "mount /dev/cdrom /media"; press Enter
		wait "mounting read-only";
		type "dpkg -i /media/testo-guest-additions-1.0.0.deb"; press Enter
		wait "Setting up testo-guest-additions"
		copyto "/home/alex/work/testo/testo/samples/" "/home/user/samples"
		exec bash """for i in {1..5}
			do
				echo "Hello world $i"
			done
		"""

		exec bash """
			cd /home/user
			echo "Hello world" > /tmp/zumba
		"""

		copyfrom "/etc/X11" "/home/alex/work/zumba"

		abort "stop here"
	}
}
