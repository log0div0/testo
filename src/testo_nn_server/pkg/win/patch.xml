<CPackWiXPatch>
	<CPackWiXFragment Id="#PRODUCT">
		<DirectoryRef Id="INSTALL_ROOT">
			<Component Id="RegistryEntries" Guid="{1f48ead4-ee79-4c3b-9199-768df1288ff8}">
				<RegistryKey Root="HKLM"
							 Key="SOFTWARE\Testo Lang\Testo NN Server"
							 Action="createAndRemoveOnUninstall">
					<RegistryValue Name="InstallDir" Type="string" Value="[INSTALL_ROOT]"/>
				</RegistryKey>
			</Component>
			<Component Id="EnvironmentVariables" Guid="{984796f7-cdf5-4211-a9d9-de89657cf7ba}">
				<Environment Id="PATH" Name="PATH" Value="[INSTALL_ROOT]/bin" Permanent="no" Part="last" Action="set" System="yes" />
				<CreateFolder/>
			</Component>
			<Directory Id="bin" Name="bin">
				<Component Id="TestoNNServer" Guid="{548b8f20-cbf3-4745-8c11-7f6a1088e3cc}">
					<File Id='TestoNNServerEXE' Source='$(var.CMAKE_BINARY_DIR)/out/sbin/$(var.CMAKE_BUILD_TYPE)/testo_nn_server.exe' Vital='yes' >
						<Permission ReadPermission="yes" Write="yes" TakeOwnership="yes" User="Everyone"/>
					</File>
					<ServiceInstall
						Id="TestoNNServerServiceInstall"
						Type="ownProcess"
						Name="testo_nn_server"
						DisplayName="Testo NN Server"
						Description="Detects text and images on screenshots"
						Start="auto"
						ErrorControl="normal"
						/>
					<ServiceControl Id="TestoNNServerServiceControl" Start="install" Stop="both" Remove="uninstall" Name="testo_nn_server" Wait="yes" />
				</Component>
			</Directory>
		</DirectoryRef>
	</CPackWiXFragment>
	<CPackWiXFragment Id="#PRODUCTFEATURE">
		<ComponentRef Id="RegistryEntries"/>
		<ComponentRef Id="EnvironmentVariables"/>
		<ComponentRef Id="TestoNNServer"/>
	</CPackWiXFragment>
</CPackWiXPatch>