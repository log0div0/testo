# Действия

## start

Запускает виртуальную машину. На момент выполнения действия
виртуальная машина должна быть выключена. Попытка запустить уже
запущенную виртуальную машину приведет к ошибке.

```
start
```

**Аргументы**: нет

## stop

Останавливает виртуальную машину, имитируя обрыв электропитания. На
момент выполнения действия виртуальная машина должна быть запущена.
Попытка остановить уже остановленную виртуальную машину приведет к
ошибке.

```
stop
```

**Аргументы**: нет

## shutdown

Посылает сигнал ACPI в виртуальную машину, запуская \"мягкую\"
остановку виртуальной машины. Команда дожидается окончания мягкой
остановки виртуальной машины. Длительность ожидания зависит от
опционального параметра `timeout_time_spec`. Для работы этой команды ОС в
виртуальной машине должна поддерживать обработку сигнала ACPI. На
момент выполнения действия виртуальная машина должна быть запущена.
Попытка остановить уже остановленную виртуальную машину приведет к
ошибке.

```
shutdown [timeout timeout_time_spec]
```

**Аргументы**:

- `timeout_time_spec` - Тип: спецификатор времени. Максимальная длительность
  ожидания остановки виртуальной машины. Значение по умолчанию -
  одна минута.

## press

Посылает в ВМ сигнал к нажатию клавиш клавиатуры, указанных в
`key_spec`. При необходимости команда press позволяет передавать
сразу последовательность нажатий клавиш. В этом случае нажатия
клавиш должны разделяться запятой. С помощью спецификатора
`interval_time_spec` можно регулировать временной интервал между нажатиями
клавиш. Виртуальная машина должна быть запущена.

```
press <key_spec1>[,key_spec2][,key_spec3]... [interval interval_time_spec]
```

**Аргументы**:

- `key_spec` - Сочетание клавиш, которое необходимо нажать.
- `interval_time_spec` - Тип: спецификатор времени. Временной
  интервал между нажатиями клавиш в прделах одной команды `press`.
  Значение по умолчанию: `30ms`. Значение по умолчанию можно
  поменять с помощью служебного параметра
  `TESTO_PRESS_DEFAULT_INTERVAL`. Подробности см.
  [здесь](param).

### Сочетание клавиш

Сочетание клавиш представляет собой особую языковую конструкцию, которая
имеет следующий формат:

```
<key_id1>[+key_id2][+key_id3]...[*number]
```

`key_id` представляет собой идентификатор с названием клавиши. Полный
список идентификаторов клавиш представлен
[здесь](keys). Идентификатор с названием
клавиши **нечувствителен к регистру**, поэтому идентификатор `enter`
эквивалентен `Enter` и `ENTER`

Сочетание клавиш состоит из двух составляющих: перечисление
**одновременно нажимаемых клавиш** и спецификатор количества повторений.
Секция одновременно перечисляемых клавиш должна состоять из ID хотя бы
одной клавиши. Если требуется одновременно нажать несколько клавиш, то
для их перечисления используется знак `+`. Спецификатор количества
повторений указывает, сколько раз необходимо нажать клавиши, указанные в
первой секции.

Несколько примеров:

- `Down` - единичное нажатие клавиши \"стрелка Вниз\"
- `LEFTCTRL + alt + Delete` - единичное нажатие сочетания клавиш
  Ctrl Alt Delete
- `LEFTCTRL + alt + Delete * 1` - эквивалентно предыдущему
- `Backspace * 6` - нажать клавишу Backspace 6 раз
- `leftalt + F2 * 3` - трижды нажать одновременно клавиши \"Left
  alt\" и F2

Примеры использования команды `press`:

- `press Down*6, Enter` - 6 раз нажать клавишу \"Вниз\", затем
  нажать \"Enter\"
- `press LeftCTRL + LEFTALT + Delete, Down*2, Enter*3` - один раз
  нажать сочетание Ctrl Alt Delete, затем два раза нажать клавишу
  \"стрелка вниз\", затем трижды - Enter

## type

Набрать с помощью клавиатуры виртуальной машины строку, указанную в
`string`. Витруальная машина должна быть включена. Если в строке
присутствуют переносы строк, они будут преобразованы в нажатие
клавиши `Enter`. Если в строке будут присутствовать знаки табуляции,
то они будут преобразованы в нажатие клавиши `Tab`.

```
type <string> [interval interval_time_spec]
```

**Аргументы**:

- `message` - Тип: строка. Строка, которую необходимо ввести с
  помощью виртуальной клавиатуры.
- `interval_time_spec` - Тип: спецификатор времени. Задержка между
  нажатиями на клавиши. Значение по умолчанию - 30 миллисекунд.
  Значение по умолчанию можно поменять с помощью служебного
  параметра `TESTO_TYPE_DEFAULT_INTERVAL`. Подробности см.
  [здесь](param).

Примеры:

```
type "Hello world"
type "Hello ${World}"
type """Hello ${World}
    Some multiline
    string ${World} another multiline
string
"""
```

## mouse

Команды, связанные с мышкой. Подробно разбираются [здесь](mouse)

## sleep

Выполнить безусловное ожидание в течение времени, указанного в `timeout_time_spec`

```
sleep <timeout timeout_time_spec>
```

**Аргументы**

- `timeout_time_spec` - Тип: спецификатор времени. Период времени, в течение
  которого требуется выполнить ожидание.

## wait

Дождаться появления на экране события, указанного в `select_expr`.
Длительность ожидания зависит от параметра `timeout_time_spec`. Если в течении
указанного периода времени нужное выражение не обнаруживается,
генерируется ошибка. С помощью спецификатора `interval_time_spec` можно
регулировать частоту проверки состояния экрана. Для работы действия
виртуальная машина должна быть запущена.

```
wait <select_expr> [timeout timeout_time_spec] [interval interval_time_spec]
```

**Аргументы**:

- `select_expr` - Выражение, которое необходимо дождаться.
  Необязательный атрибут.
- `timeout_time_spec` - Тип: спецификатор времени. Максимальная
  длительность ожидания выражения. Значение по умолчанию - одна
  минута. Значение по умолчанию можно поменять с помощью служебного
  параметра `TESTO_WAIT_DEFAULT_TIMEOUT`. Подробности см.
  [здесь](param).
- `interval_time_spec` - Тип: спецификатор времени. Время между
  проверками состояния экрана. Значение по умолчанию - одна секунда.
  Значение по умолчанию можно поменять с помощью служебного
  параметра `TESTO_WAIT_DEFAULT_INTERVAL`. Подробности см.
  [здесь](param).

### Формат выражений для команд wait и check

Команды `wait` и `check` предоставляют возможность осуществлять как
базовые проверки (простой факт наличия строки или комбинации строк на
экране), так и более сложные проверки (где требуется задавать более
сложные уточнения). Базовые проверки на строки можно осуществляются с
помощью **строк**, тогда как более сложные - с помощью **запросов**. В
одной команде `wait` или `check` с помощью логических операторов можно
комбинировать несколько строк и запросов.

**Базовые проверки с помощью строк**

Если требуется простая проверка наличия надписи на экране, то достаточно
использовать команду `wait` в следующем формате

```
wait "Искомая строка"
```

Внутри строк можно использовать обращение к параметрам

```
wait "Искомая строка с параметром ${param}"
```

**Сложные проверки с помощью запросов**

Для более сложных проверок в команды `wait` и `check` можно передавать
запросы, написанные на языке `javascript`. Javascript обязательно должен
возвращать значение `true` или `false`.

Если javascript вернул значение `true`, то команды `wait` и `check`
считается выполненной и управление переходит к следующему действию. Если
вернулось значение `false`, то команды `wait` и check продолжат свою
работу до тех пор, пока не будет возвращено значение `true` или не
закончвится таймаут. Все остальные возвращаемые значения будут
восприниматься как ошибка и приводить к остановке выполнения теста.

```
wait js "find_text('Hello world').foreground('blue').background('gray').size() == 1"
```

Пример выше позволяет проверить наличие на экране строку \"Hello
world\", у которой цвет букв - синий, а цвет фона - серый. Такая строка
может олицетворять, например, выделенный пункт меню.

Более подробно про построение запросов с помощью javascript можно
почитать [здесь](../js/general).

**Комбинация нескольких проверок в одной команде**

Проверки можно комбинировать с помощью логических операторов `&&` (И),
`||` (ИЛИ) и `!` (отрицание), формируя, таким образом, выражения
`select_expr`. Выражения также поддерживают скобки для вычисления
вложенных выражений.

Примеры:

```
wait "Hello world" && "${param}"
```

Дождаться одновременного наличия на экране надписи "Hello world" и
надписи, содержащей значение переменной `param`

```
wait !"Hello world" || js """
    find_text()
        .match("Menu entry")
        .match_foreground("${foreground_colour}")
        .match_background("gray")
        .size() == 1
""" timeout 10m interval 10s
```

Дождаться либо отсутствия на экране надписи "Hello world", либо
наличия на экране надписи "Menu entry" с серым фоном и цветом букв,
определенным в параметре `foreground_colour`. Частота проверок состояния
экрана - 1 раз в 10 секунд. Максимальное время ожидания - 10 минут.

## Вызов макроса

Вызвать макрос `macro_name`. Макрос должен быть заранее объявлен.

```
<macro_name> ([param1, param2, ...])
```

**Аргументы**: Количество аргументов не должно быть больше, чем
количество аргументов в объявлнении макроса. Если при вызове макроса
передается меньше аргументов, чем в его объявлении, то недостающие
аргументы будут вычислены на основе значений по умолчанию (если таковые
имеются). Допускаются только строковые аргументы.

## plug

Действие `plug` предназначено для подключения различных устройств к
виртуальной машине. Ниже преведены доступные варианты этой команды

### plug flash

Подключить флеш-накопитель к виртуальной машине.

```
plug flash <flash_name>
```

**Аргументы**:

- `flash_name` - Тип: идентификатор. Имя флеш-накопителя, который
  нужно подключить к виртуальной машине. Флеш-накопитель должен быть
  предварительно объявлен.

### plug nic

Подключить сетевой адаптер к виртуальной машине. Имя сетевого
адаптера должно соответствовать имени, указанному в атрибуте `nic` в
объявлении виртуальной машины.

```
plug nic <nic_name>
```

**Аргументы**:

- `nic_name` - Тип: идентификатор. Имя сетевого адаптера, который
  необходимо подключить. Сетевой адаптер должен быть объявлен в
  конфигурации виртуальной машины.

### plug link

Подключить кабель к сетевому адаптеру. Имя сетевого адаптера должно
соответствовать имени, указанному в атрибуте `nic` в объявлении
виртуальной машины.

```
plug link <nic_name>
```

**Аргументы**:

- `nic_name` - Тип: идентификатор. Имя сетевого адаптера, к которому
  необходимо подключить кабель.

### plug dvd

Подключить iso-образ с образом к диску к dvd-приводу. Имя сетевого
адаптера должно соответствовать имени, указанному в атрибуте `nic` в
объявлении виртуальной машины.

```
plug dvd <path_to_iso_file>
```

**Аргументы**:

- `path_to_iso_file` - Тип: строка. Путь к iso-образу.

## unplug

Действие `unplug` предназначено для отключения различных устройств от
виртуальной машины. Ниже приведены доступные варианты этой команды

### unplug flash

Отключить флеш-накопитель от виртуальной машины.

```
unplug flash <flash_name>
```

**Аргументы**:

- `flash_name` - Тип: идентификатор. Имя флеш-накопителя, который
  нужно отключить. Флеш-накопитель должен быть предварительно
  объявлен.

### unplug nic

Отключить сетевой адаптер от виртуальной машины. Имя сетевого
адаптера должно соответствовать имени, указанному в атрибуте `nic` в
объявлении виртуальной машины.

```
unplug nic <nic_name>
```

**Аргументы**:

- `nic_name` - Тип: идентификатор. Имя сетевого адаптера, который
  необходимо отключить. Сетевой адаптер должен быть объявлен в
  конфигурации виртуальной машины.

### unplug link

Отключить кабель от сетевого адаптера. Имя сетевого адаптера должно
соответствовать имени, указанному в атрибуте `nic` в объявлении
виртуальной машины.

```
unplug link <nic_name>
```

**Аргументы**:

- `nic_name` - Тип: идентификатор. Имя сетевого адаптера, от
  которого необходимо отключить кабель.

### unplug dvd

Отключить текущий iso-образ от dvd-привода.

```
unplug dvd
```

**Аргументы**: нет

## exec

Выполняет в виртуальной машине команду, указанную в `<string>` с
помощью интерпретатора, который указан в `<interpreter>`. Для работы
необходимо наличие в виртуальной машине агента
`testo-guest-additions`. Если интерпретатор выполнил команду с
ошибкой (код возврата не равен 0), то команда `exec` завершает
текущий тест с ошибкой. Поток вывода и поток ошибок команды
перенаправляется на поток вывода интерпретатора `testo` и
пользователь может наблюдать за ходом выполнения команд в режиме
реального времени.

```
exec <interpreter> <string> [timeout timeout_time_spec]
```

**Аргументы**:

- `interpreter` - Тип: идентификатор. Имя интерпретатора, который
  будет выполнять команду. В настоящее время поддерживается
  интерпретаторы `bash`, `python`, `python2` и `python3`.
- `string` - Тип: строка. Команда, которую необходимо выполнить.
- `timeout_time_spec` - Тип: спецификатор времени. Максимальное
  время ожидания выполнения команды. Значение по умолчанию - 10
  минут. Значение по умолчанию можно поменять с помощью служебного
  параметра `TESTO_EXEC_DEFAULT_TIMEOUT`. Подробности см.
  [здесь](param).

## copyto

Копирует файл или папку из хостовой машины на виртуальную машину.
Для работы необходимо наличие в виртуальной машине агента
`negotiator`.

```
copyto <from> <to> [timeout timeout_time_spec]
```

**Аргументы**:

- `from` - Тип: строка. Путь к файлу или папке на хостовой машине,
  которую необходимо скопировать на виртуальную машину.
- `to` - Тип: строка. **Полный** путь назначения на виртуальной
  машине.
- `timeout_time_spec` - Тип: спецификатор времени. Максимальное
  время ожидания завершения копирования файлов. Значение по
  умолчанию - 10 минут. Значение по умолчанию можно поменять с
  помощью служебного параметра `TESTO_COPY_DEFAULT_TIMEOUT`.
  Подробности см. [здесь](param).

> В качестве пути назначения должен фигурировать полный путь (то есть с
> указанием конечного файла или папки). Например, если необходимо
> скопировать файл `/home/user/some_file.txt` на виртуальную машину, то
> нужно выполнить команду
> `copyto /home/user/some_file.txt /path/on/vm/some_file.txt`. Аналогично
> необходимо поступать с копированием папок.

> Не допускается копирование ссылок

## copyfrom

Копипует файл или папку из виртуальной машины на хост. Для работы
необходимо наличие в виртуальной машине агента `negotiator`

```
copyfrom <from> <to> [timeout timeout_time_spec]
```

**Аргументы**:

- `from` - Тип: строка. Путь к файлу или папке на виртуальной
  машине, которую необходимо скопировать на хост.
- `to` - Тип: строка. **Полный** путь назначения на хостовой машине.
- `timeout_time_spec` - Тип: спецификатор времени. Максимальное
  время ожидания завершения копирования файлов. Значение по
  умолчанию - 10 минут. Значение по умолчанию можно поменять с
  помощью служебного параметра `TESTO_COPY_DEFAULT_TIMEOUT`.
  Подробности см. [здесь](param).

> В качестве пути назначения должен фигурировать полный путь (то есть с
> указанием конечного файла или папки) (см. copyto)

> Не допускается копирование ссылок

## abort

Аварийно завершает выполнение текущего теста и генерирует сообщение
об ошибке. Тест считается неудачно завершившимся.

```
abort <error_message>
```

**Аргументы**:

- `error_message` - Тип: строка. Сообщение об ошибке.

## print

Выводит на экран сообщение, после чего тест продолжает работу.

```
print <message>
```

**Аргументы**:

- `message` - Тип: строка. Сообщение, которое необходимо вывести на
  экран.
